<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <!-- Accesibilidad: no bloquear zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title data-i18n="meta.contact.title">Contacto — Missael Rangel</title>
    <meta name="description"
        content="¿Trabajamos juntos? Contáctame por correo o teléfono. Disponible en Guadalajara y remoto. Respondo rápido."
        data-i18n="meta.contact.description" data-i18n-attr="content" />

    <!-- Preconfiguración de idioma + reCAPTCHA antes de cargar script -->
    <script>
        (function () {
            var K = "site:lang";
            var saved = null;
            try { saved = localStorage.getItem(K); } catch (e) { }

            var nav = (navigator.language || "es").toLowerCase();
            var lang = (saved === "en" || saved === "es") ? saved : (nav.startsWith("es") ? "es" : "en");

            // Refleja el idioma en <html>
            var html = document.documentElement;
            html.classList.add("lang-" + lang);
            html.setAttribute("lang", lang);

            // Fuerza idioma de reCAPTCHA ANTES de cargar el script
            window.___grecaptcha_cfg = window.___grecaptcha_cfg || {};
            window.___grecaptcha_cfg.lang = (lang === "en" ? "en" : "es");

            // Inyecta el script de reCAPTCHA con ?hl=...
            var s = document.createElement("script");
            s.src = "https://www.google.com/recaptcha/api.js?hl=" + (lang === "en" ? "en" : "es");
            s.async = true;
            s.defer = true;
            document.head.appendChild(s);
        })();
    </script>

    <!-- Estilos -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png" />
    <link rel="stylesheet" href="assets/fonts/fontawesome-free-6.1.2-web/css/all.min.css" />
    <link rel="stylesheet" href="assets/fonts/poppins/poppins.css" />
    <link rel="stylesheet" href="assets/css/reset.css" />
    <link rel="stylesheet" href="assets/css/scroll.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/loader.css" />
    <link rel="stylesheet" href="assets/css/responsive.css" />
    <link rel="canonical" href="https://missaelr.com/contacto.html" />

    <!-- i18n -->
    <script defer src="assets/js/translations.js"></script>
    <script defer src="assets/js/i18n.js"></script>

    <!-- Scripts -->
    <script defer src="assets/js/menu.js"></script>
    <script defer src="assets/js/map.js"></script>

    <!-- Datos estructurados (SEO) -->
    <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Person",
    "name":"Missael Rangel",
    "jobTitle":"Frontend Web Developer",
    "url":"https://missaelr.com/",
    "email":"mailto:missael.rangeel@gmail.com",
    "telephone":"+52-33-3245-8102",
    "address": {"@type":"PostalAddress","addressLocality":"Guadalajara","addressCountry":"MX"},
    "sameAs":[
      "https://www.linkedin.com/in/missaelrangel",
      "https://github.com/zpymis"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "sales",
      "email": "mailto:missael.rangeel@gmail.com",
      "availableLanguage": ["es","en"]
    }
  }
  </script>
</head>

<body>
    <div class="layout">
        <aside id="aside-nav" class="layout__aside">
            <section class="aside__user-info">
                <div class="user-info__general">
                    <div class="user-info__container-image">
                        <img src="assets/img/profile.png" class="user-info__image" width="360"
                            decoding="async" data-i18n="common.profileAlt" data-i18n-attr="alt"
                            alt="Foto de perfil de Missael Rangel" />
                    </div>
                    <h2 class="user-info__name">Missael Rangel</h2>
                    <h4 class="user-info__job" data-i18n="common.userJob">Desarrollador Web Frontend</h4>
                </div>

                <nav class="layout__menu" data-i18n="common.primaryNav" data-i18n-attr="aria-label"
                    aria-label="Navegación principal">
                    <ul class="menu__list">
                        <li class="menu__option">
                            <a href="index.html" class="menu__link">
                                <i class="menu__icon fa-solid fa-house" aria-hidden="true"></i>
                                <span class="menu__overlay" data-i18n="nav.home">Inicio</span>
                            </a>
                        </li>
                        <li class="menu__option">
                            <a href="sobre-mi.html" class="menu__link">
                                <i class="menu__icon fa-solid fa-user" aria-hidden="true"></i>
                                <span class="menu__overlay" data-i18n="nav.about">Sobre mí</span>
                            </a>
                        </li>
                        <li class="menu__option">
                            <a href="portafolio.html" class="menu__link">
                                <i class="menu__icon fa-solid fa-briefcase" aria-hidden="true"></i>
                                <span class="menu__overlay" data-i18n="nav.portfolio">Portafolio</span>
                            </a>
                        </li>
                        <li class="menu__option">
                            <a href="contacto.html" class="menu__link menu__link--active" aria-current="page">
                                <i class="menu__icon fa-solid fa-envelope" aria-hidden="true"></i>
                                <span class="menu__overlay" data-i18n="nav.contact">Contacto</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <div class="lang-toggle" role="group" data-i18n="common.langToggleLabel" data-i18n-attr="aria-label"
                    aria-label="Selector de idioma">
                    <button type="button" class="lang-toggle__btn" data-lang="es" aria-pressed="false">ES</button>
                    <button type="button" class="lang-toggle__btn" data-lang="en" aria-pressed="false">EN</button>
                </div>

                <div class="user-info__links">
                    <ul class="links__social">
                        <li class="social__option">
                            <a href="https://www.linkedin.com/in/missaelrangel" class="social__link"
                                rel="noopener noreferrer" target="_blank" aria-label="LinkedIn de Missael Rangel">
                                <i class="social__icon fa-brands fa-linkedin" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="social__option">
                            <a href="https://github.com/zpymis" class="social__link" rel="noopener noreferrer"
                                target="_blank" aria-label="GitHub de Missael Rangel">
                                <i class="social__icon fa-brands fa-github" aria-hidden="true"></i>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="user-info__buttons">
                    <a href="assets/Missael_Rangel_Resume.pdf" class="user-info__btn" data-i18n="common.downloadCV"
                        rel="noopener noreferrer" target="_blank">Descargar CV</a>
                </div>

                <footer class="user-info__footer">
                    &copy; 2025 Missael Rangel
                </footer>
            </section>
        </aside>

        <div class="layout__menu-toggle" role="button" tabindex="0" aria-expanded="false" data-i18n-attr="aria-label"
            aria-controls="aside-nav" aria-label="Abrir menú">
            <i class="menu-toggle__icon fa-solid fa-bars" aria-hidden="true"></i>
            <i class="menu-toggle__icon fa-solid fa-xmark" aria-hidden="true"></i>
        </div>

        <main class="layout__content">
            <section class="content__page content__contact">
                <header class="contact__header">
                    <h1 class="contact__title" data-i18n="contact.title">Contacto</h1>
                </header>

                <div class="contact__container">
                    <section class="contact__info">
                        <div class="contact__data">
                            <i class="contact__icon fa-solid fa-location-dot" aria-hidden="true"></i>
                            <h2 class="contact__subtitle" data-i18n="contact.city">Guadalajara</h2>
                        </div>

                        <div class="contact__data">
                            <i class="contact__icon fa-solid fa-phone" aria-hidden="true"></i>
                            <h2 class="contact__subtitle">
                                <a href="tel:+523332458102">3332458102</a>
                            </h2>
                        </div>

                        <div class="contact__data">
                            <i class="contact__icon fa-solid fa-envelope" aria-hidden="true"></i>
                            <h2 class="contact__subtitle">
                                <a href="mailto:missael.rangeel@gmail.com">missael.rangeel@gmail.com</a>
                            </h2>
                        </div>

                        <div class="contact__data">
                            <i class="contact__icon fa-solid fa-circle-check" aria-hidden="true"></i>
                            <h2 class="contact__subtitle" data-i18n="common.userJob">Desarrollador Web Frontend</h2>
                        </div>
                    </section>

                    <section class="contact__form-box">
                        <div class="contact__map" id="load-iframe-map" aria-label="Mapa con ubicación de Guadalajara">
                            <span class="loader"></span>
                        </div>

                        <header class="contact__form-header">
                            <h3 class="form-header__title" data-i18n="contact.form.header" data-i18n-html>
                                ¿Cómo puedo <span class="u-accent-strong">ayudarte?</span>
                            </h3>
                        </header>

                        <!-- Netlify Forms + validación custom -->
                        <form id="contactForm" class="contact__form" name="contacto" method="POST" data-netlify="true"
                            netlify-honeypot="bot-field" accept-charset="UTF-8" novalidate>
                            <!-- Netlify / Honeypot -->
                            <input type="hidden" name="form-name" value="contacto" />
                            <p class="u-hidden" aria-hidden="true">
                                <label>No llenes este campo: <input name="bot-field" tabindex="-1"
                                        autocomplete="off" /></label>
                            </p>

                            <div class="form__container">
                                <section class="form__left">
                                    <div class="form__group">
                                        <!-- NOMBRE -->
                                        <input id="name" type="text" class="form__input" name="name" required
                                            minlength="2" maxlength="80" pattern="^[A-Za-zÀ-ÖØ-öø-ÿ.'\- ]{2,}$"
                                            title="Escribe tu nombre (solo letras y espacios)." aria-required="true"
                                            data-i18n="contact.form.name" data-i18n-attr="placeholder,aria-label,title"
                                            placeholder="Nombre" autocomplete="name" autocapitalize="words"
                                            enterkeyhint="next" />
                                        <label for="name" class="form__label"
                                            data-i18n="contact.form.nameLabel">Nombre</label>
                                    </div>

                                    <div class="form__group">
                                        <!-- EMAIL -->
                                        <input id="email" type="email" class="form__input" name="email" required
                                            inputmode="email" autocomplete="email" maxlength="254"
                                            pattern="^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?(?:\.[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?)+$"
                                            title="Ingresa un correo válido." aria-required="true"
                                            data-i18n="contact.form.email" data-i18n-attr="placeholder,aria-label,title"
                                            placeholder="Correo" spellcheck="false" enterkeyhint="next" />
                                        <label for="email" class="form__label"
                                            data-i18n="contact.form.emailLabel">Correo</label>
                                    </div>

                                    <div class="form__group">
                                        <!-- ASUNTO -->
                                        <input id="subject" type="text" class="form__input" name="subject" required
                                            minlength="4" maxlength="120"
                                            title="Escribe un asunto (mínimo 4 caracteres)." aria-required="true"
                                            data-i18n="contact.form.subject"
                                            data-i18n-attr="placeholder,aria-label,title" placeholder="Asunto"
                                            enterkeyhint="next" />
                                        <label for="subject" class="form__label"
                                            data-i18n="contact.form.subjectLabel">Asunto</label>
                                    </div>
                                </section>

                                <section class="form__right">
                                    <div class="form__group form__group--textarea">
                                        <!-- MENSAJE -->
                                        <textarea id="message" class="form__input form__input--textarea" name="message"
                                            required minlength="10" maxlength="1000"
                                            title="Cuéntame los detalles de tu proyecto." aria-required="true"
                                            data-i18n="contact.form.message"
                                            data-i18n-attr="placeholder,aria-label,title" placeholder="Mensaje"
                                            spellcheck="true" enterkeyhint="send"></textarea>
                                        <label for="message" class="form__label"
                                            data-i18n="contact.form.messageLabel">Mensaje</label>
                                    </div>
                                </section>
                            </div>

                            <!-- reCAPTCHA de Netlify -->
                            <div class="form__group form__group--captcha">
                                <div data-netlify-recaptcha="true"></div>
                                <p class="form__error" id="recaptchaError" role="alert" aria-live="polite"></p>
                            </div>

                            <input type="submit" class="form__button" data-i18n="contact.form.submit"
                                data-i18n-attr="value" value="Enviar mensaje" />
                        </form>

                        <!-- Mensajes bajo el formulario -->
                        <div class="form__notice" id="formSuccess" role="status" aria-live="polite"
                            data-i18n="contact.form.success" hidden>
                            ¡Gracias! Tu mensaje fue enviado correctamente. Te responderé pronto.
                        </div>
                        <div class="form__notice form__notice--error" id="formError" role="alert"
                            data-i18n="contact.form.error" hidden>
                            Ocurrió un problema al enviar el formulario. Inténtalo de nuevo.
                        </div>
                    </section>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('.contact__form');
            if (!form) return;

            const submitBtn = form.querySelector('.form__button');
            const captchaWrap = form.querySelector('.form__group--captcha');
            let captchaErr = document.getElementById('recaptchaError');
            const okEl = document.getElementById('formSuccess');
            const errEl = document.getElementById('formError');

            // ---------- i18n helpers ----------
            const T = (key, fb) =>
                (window.i18n && typeof i18n.t === 'function' && i18n.t(key)) || fb;

            const currentLang = () =>
                (window.i18n && typeof i18n.current === 'function' && i18n.current()) ||
                document.documentElement.getAttribute('lang') || 'es';

            function buildMsgs() {
                return {
                    name: T('contact.form.errors.name', 'Escribe tu nombre (solo letras y espacios, mínimo 2).'),
                    email: T('contact.form.errors.email', 'Ingresa un email válido.'),
                    subject: T('contact.form.errors.subject', 'Escribe un asunto (mínimo 4 caracteres).'),
                    message: T('contact.form.errors.message', 'Escribe un mensaje (mínimo 10 caracteres).'),
                    default: T('contact.form.errors.default', 'Completa este campo.'),
                    recaptcha: T('contact.form.errors.recaptcha', 'Marca “No soy un robot” antes de enviar.')
                };
            }
            let MSG = buildMsgs();

            // ---------- validación suave ----------
            const EMAIL_RE =
                /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?(?:\.[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?)+$/;

            function validateField(el) {
                const v = (el.value || '').trim();
                let msg = '';
                if (el.required && !v) {
                    msg = MSG.default;
                } else {
                    switch (el.id) {
                        case 'name': if (v.length < 2) msg = MSG.name; break;
                        case 'email': if (!EMAIL_RE.test(v)) msg = MSG.email; break;
                        case 'subject': if (v.length < 4) msg = MSG.subject; break;
                        case 'message': if (v.length < 10) msg = MSG.message; break;
                    }
                }
                el.setCustomValidity(msg);
                el.toggleAttribute('aria-invalid', !!msg);
                return !msg;
            }

            form.querySelectorAll('input[required], textarea[required]').forEach(el => {
                el.addEventListener('input', () => validateField(el));
            });

            // ---------- utils captcha ----------
            function captchaResponse() {
                try {
                    if (window.grecaptcha && typeof grecaptcha.getResponse === 'function') {
                        return grecaptcha.getResponse();
                    }
                    const t = document.querySelector('.g-recaptcha-response');
                    return t ? t.value : '';
                } catch { return ''; }
            }
            function showCaptchaError() { if (captchaErr) captchaErr.textContent = MSG.recaptcha; }
            function clearCaptchaError() { if (captchaErr) captchaErr.textContent = ''; }

            // ---------- helpers de UI / envío ----------
            function setHidden(el, hidden) {
                if (!el) return;
                if (hidden) el.setAttribute('hidden', '');
                else el.removeAttribute('hidden');
            }
            function encode(formData) {
                return new URLSearchParams(formData).toString();
            }
            async function sendNetlify(form) {
                const fd = new FormData(form);
                // Adjunta token de reCAPTCHA si existe
                try {
                    if (window.grecaptcha && typeof grecaptcha.getResponse === 'function') {
                        const token = grecaptcha.getResponse();
                        if (token) fd.append('g-recaptcha-response', token);
                    }
                } catch { }
                const res = await fetch('/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: encode(fd)
                });
                return res.ok;
            }

            // ---------- submit (AJAX, sin redirigir) ----------
            form.addEventListener('submit', async (e) => {
                clearCaptchaError();
                setHidden(okEl, true);
                setHidden(errEl, true);

                const fields = Array.from(form.querySelectorAll('input[required], textarea[required]'));
                const firstInvalid = fields.find(f => !validateField(f));
                if (firstInvalid) {
                    e.preventDefault();
                    firstInvalid.reportValidity();
                    firstInvalid.focus();
                    return;
                }
                if (!captchaResponse()) {
                    e.preventDefault();
                    showCaptchaError();
                    captchaWrap.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }

                // ✅ Enviar por AJAX a Netlify sin recargar
                e.preventDefault();
                submitBtn?.setAttribute('disabled', 'true');
                try {
                    const ok = await sendNetlify(form);
                    if (ok) {
                        form.reset();
                        try { grecaptcha.reset(); } catch { }
                        setHidden(okEl, false);
                        okEl.setAttribute('tabindex', '-1');
                        okEl.focus({ preventScroll: true });
                        okEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        setHidden(errEl, false);
                    }
                } catch {
                    setHidden(errEl, false);
                } finally {
                    submitBtn?.removeAttribute('disabled');
                }
            });

            // =================================================================
            //      reCAPTCHA: capturar sitekey y re-renderizar al cambiar idioma
            // =================================================================
            const RC = { sitekey: null, widgetId: null };
            let loadingRecaptcha = false;

            // Captura una vez el sitekey desde el widget inicial insertado por Netlify
            async function captureSitekeyOnce(timeout = 10000) {
                if (RC.sitekey) return true;
                const ok = await waitFor(() => {
                    // 1) desde el div .g-recaptcha
                    const g = captchaWrap.querySelector('.g-recaptcha');
                    if (g && g.getAttribute('data-sitekey')) {
                        RC.sitekey = g.getAttribute('data-sitekey');
                        return true;
                    }
                    // 2) desde el iframe (param k)
                    const ifr = captchaWrap.querySelector('iframe[src*="recaptcha"]');
                    if (ifr && ifr.src) {
                        try {
                            const u = new URL(ifr.src);
                            const k = u.searchParams.get('k');
                            if (k) { RC.sitekey = k; return true; }
                        } catch { }
                    }
                    return false;
                }, timeout);
                return ok;
            }

            function waitFor(testFn, timeout = 2000, interval = 60) {
                return new Promise(resolve => {
                    const start = Date.now();
                    (function tick() {
                        if (testFn()) return resolve(true);
                        if (Date.now() - start > timeout) return resolve(false);
                        setTimeout(tick, interval);
                    })();
                });
            }

            // Helpers para limpiar/cargar script
            function removeRecaptchaScripts() {
                // google.com y recaptcha.net; estándar y enterprise
                document.querySelectorAll(
                    'script[src*="recaptcha/api.js"],script[src*="recaptcha/enterprise.js"],' +
                    'script[src*="//www.recaptcha.net/recaptcha/api.js"],script[src*="//www.recaptcha.net/recaptcha/enterprise.js"]'
                ).forEach(s => s.remove());
            }

            // Render explícito tras cambiar idioma (sin recargar página)
            async function rerenderRecaptcha(lang) {
                if (loadingRecaptcha) return;
                loadingRecaptcha = true;
                try {
                    // Asegura sitekey
                    if (!RC.sitekey) {
                        const got = await captureSitekeyOnce(12000);
                        if (!got) return; // no rompemos nada si no se pudo capturar
                    }

                    // 1) Limpia contenedor, preservando el <p id="recaptchaError">
                    const errText = captchaErr?.textContent || '';
                    captchaWrap.innerHTML = `<div id="recaptcha-container"></div>
<p class="form__error" id="recaptchaError" role="alert" aria-live="polite">${errText}</p>`;
                    captchaErr = document.getElementById('recaptchaError');

                    // 2) Elimina widget previo por completo
                    removeRecaptchaScripts();
                    captchaWrap.querySelectorAll('iframe[src*="recaptcha"], .g-recaptcha, .grecaptcha-badge').forEach(n => n.remove());
                    captchaWrap.querySelectorAll('.g-recaptcha-response').forEach(n => n.remove());

                    // 3) Resetea globals y fija idioma
                    try { delete window.grecaptcha; } catch { }
                    try { delete window.__google_recaptcha_client; } catch { }
                    try { delete window.___grecaptcha_cfg; } catch { }
                    window.___grecaptcha_cfg = { lang: (lang === 'en' ? 'en' : 'es') };

                    // 4) Carga el script con render=explicit + callback + cache-buster
                    const cbName = '__onRecaptchaReady';
                    window[cbName] = function () {
                        try {
                            grecaptcha.ready(function () {
                                RC.widgetId = grecaptcha.render('recaptcha-container', {
                                    sitekey: RC.sitekey
                                    // theme: 'dark' // opcional
                                });
                                // Limpieza del callback global
                                try { delete window[cbName]; } catch { }
                            });
                        } catch { }
                    };

                    const bust = Date.now();
                    const src = `https://www.google.com/recaptcha/api.js?render=explicit&onload=${cbName}&hl=${(lang === 'en' ? 'en' : 'es')}&cb=${bust}`;
                    const s = document.createElement('script');
                    s.src = src; s.async = true; s.defer = true;
                    document.body.appendChild(s);
                } finally {
                    loadingRecaptcha = false;
                }
            }

            // Carga inicial del script si no vino del <head>
            (function ensureRecaptcha() {
                const hasScript = Array.from(document.scripts).some(s => (s.src || '').includes('/recaptcha/api.js'));
                if (!hasScript) {
                    const lang = currentLang() === 'en' ? 'en' : 'es';
                    // Fija idioma antes de cargar
                    window.___grecaptcha_cfg = window.___grecaptcha_cfg || {};
                    window.___grecaptcha_cfg.lang = lang;

                    // Auto-render (Netlify) en primera carga
                    const s = document.createElement('script');
                    s.src = 'https://www.google.com/recaptcha/api.js?hl=' + lang;
                    s.async = true;
                    s.defer = true;
                    document.body.appendChild(s);
                }
            })();

            // Captura sitekey pronto (por si luego cambias idioma rápido)
            window.addEventListener('load', () => { captureSitekeyOnce(); });

            // Toggle de idioma: NO recargamos; re-render explícito con el nuevo idioma
            document.querySelectorAll('.lang-toggle__btn[data-lang]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const newLang = btn.dataset.lang === 'en' ? 'en' : 'es';
                    setTimeout(() => {
                        MSG = buildMsgs();
                        clearCaptchaError();
                        rerenderRecaptcha(newLang);
                    }, 0);
                });
            });
        });
    </script>
</body>

</html>